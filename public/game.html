<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BridgeCircle - Game</title>
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/multiplayer.css">
    <meta name="description" content="Multiplayer bridge game">
</head>
<body>
    <div class="container" id="game-view">
        <h1>BridgeCircle - Table <span id="game-table-code"></span></h1>
        
        <div id="error-container" class="error-message" style="display:none;"></div>
        
        <!-- ARIA Live area for announcements -->
        <div id="status-announcer" class="sr-only" aria-live="polite" aria-atomic="true"></div>
        
        <!-- ARIA Live area specifically for card plays -->
        <div id="card-announcer" class="sr-only" aria-live="assertive" aria-atomic="false"></div>
        
        <!-- Invisible focus target to help with screen reader issues -->
        <span id="card-focus-target" tabindex="-1" aria-hidden="true" style="position:absolute;left:-9999px"></span>
        
        <!-- Player management -->
        <section class="section">
            <h2>Players</h2>
            <div class="player-controls" id="player-controls">
                <!-- Player information will be added here by JavaScript -->
            </div>
        </section>
        
        <!-- Status message display -->
        <div class="status-bar" id="status-bar" role="status">
            Welcome to BridgeCircle game
        </div>
        
        <!-- Action buttons -->
        <div class="action-buttons">
            <button id="toggle-help-button" class="button button-secondary">
                Show Help
            </button>
            
            <button id="leave-game-button" class="button button-secondary">
                Leave Game
            </button>
            
            <button id="fullscreen-button" class="button button-secondary">
                Full Screen
            </button>
        </div>
        
        <!-- Help section (initially hidden) -->
        <section class="help-section" id="help-section" style="display: none;" role="dialog" aria-labelledby="help-heading">
            <h2 id="help-heading">Keyboard Shortcuts</h2>
            <ul class="help-list" id="help-list">
                <!-- Help text will be populated by JavaScript -->
            </ul>
            <button id="close-help-button" class="button">
                Close Help
            </button>
        </section>
        
        <!-- Bidding area -->
        <section class="section" id="bidding-area" style="display: none;">
            <h2>Bidding Phase</h2>
            <div id="bidding-history" class="bidding-history">
                <h3>Bidding History</h3>
                <p>No bids yet.</p>
            </div>
            <div id="bidding-controls" class="bidding-controls">
                <h3>Your Bid</h3>
                <p>Waiting for bidding to start...</p>
            </div>
        </section>
        
        <!-- Game table -->
        <div class="game-table">
            <!-- North (top) -->
            <div class="hand north-hand" id="north-hand">
                <h3>North</h3>
                <!-- Card information will be added here by JavaScript -->
            </div>
            
            <!-- East (right) -->
            <div class="hand east-hand" id="east-hand">
                <h3>East</h3>
                <p>Cards: ?</p>
            </div>
            
            <!-- Center area -->
            <div class="center-area" id="center-area">
                <!-- Played cards and center information will be added here -->
            </div>
            
            <!-- West (left) -->
            <div class="hand west-hand" id="west-hand">
                <h3>West</h3>
                <p>Cards: ?</p>
            </div>
            
            <!-- South (bottom - player's hand) -->
            <div class="hand south-hand" id="south-hand">
                <h3>Your Hand (South)</h3>
                <!-- Card information will be added here by JavaScript -->
            </div>
        </div>
        
        <!-- Played cards -->
        <section class="section" id="played-cards-section">
            <h2>Played Cards</h2>
            <div id="played-cards-container">
                <p class="text-gray-500">No cards played yet.</p>
            </div>
        </section>
        
        <!-- Chat Section for in-game chat -->
        <div class="section">
            <h2>Game Chat</h2>
            <div id="chat-messages" class="chat-messages" aria-live="polite"></div>
            <div class="chat-input-container">
                <input type="text" id="chat-input" class="chat-input" placeholder="Type a message...">
                <button id="send-chat-button" class="button">Send</button>
            </div>
        </div>
    </div>
    
    <script src="/socket.io/socket.io.js"></script>
    <script src="scripts/socket-handler.js"></script>
    <script src="scripts/ui.js"></script>
    <script src="scripts/client-bridge.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Indicate that we're in multiplayer game mode
            window.isMultiplayerMode = true;
            
            // Get table code from URL
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.has('code')) {
                // Setup game screen with the table code
                clientState.tableCode = urlParams.get('code');
                setupGameScreen();
            } else {
                // Redirect to home page if no code provided
                window.location.href = '/';
            }
            
            // Handle game exit button
            document.getElementById('leave-game-button').addEventListener('click', function() {
                if(confirm('Are you sure you want to leave the game? You will be replaced by GIB AI.')) {
                    leaveTable();
                }
            });
            
            // Setup help and fullscreen buttons
            document.getElementById('toggle-help-button').addEventListener('click', toggleHelp);
            document.getElementById('close-help-button').addEventListener('click', toggleHelp);
            document.getElementById('fullscreen-button').addEventListener('click', toggleFullscreenMode);
        });
        
        // Toggle help display
        function toggleHelp() {
            const helpSection = document.getElementById('help-section');
            const isVisible = helpSection.style.display !== 'none';
            helpSection.style.display = isVisible ? 'none' : 'block';
            document.getElementById('toggle-help-button').textContent = isVisible ? 'Show Help' : 'Hide Help';
        }
        
        // Toggle fullscreen mode
        function toggleFullscreenMode() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen().catch(err => {
                    console.error(`Error attempting to enable fullscreen: ${err.message}`);
                });
                document.getElementById('fullscreen-button').textContent = 'Exit Full Screen';
            } else {
                document.exitFullscreen();
                document.getElementById('fullscreen-button').textContent = 'Full Screen';
            }
        }
    </script>
</body>
</html>