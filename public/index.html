<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BridgeCircle - Accessible Bridge</title>
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/multiplayer.css">
    <meta name="description" content="Accessible Bridge application with GIB AI integration">
</head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-5FYNNQ6K4K"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-5FYNNQ6K4K');
</script>
<body>
    <!-- Multiplayer Lobby View -->
    <div class="container" id="lobby-view">
        <h1>BridgeCircle - Accessible Bridge</h1>
        
        <!-- ARIA Live area for announcements -->
        <div id="lobby-announcer" class="sr-only" aria-live="polite" aria-atomic="true"></div>
        
        <div class="section">
            <h2>Welcome to BridgeCircle</h2>
            <p>You can create a new table or join an existing one.</p>
            
            <div class="action-buttons">
                <button id="create-table-button" class="button">
                    Create Table
                </button>
                
                <button id="join-table-button" class="button button-secondary">
                    Join Table
                </button>
                
                <button id="play-solo-button" class="button">
                    Play Solo (with GIB)
                </button>
            </div>
            
            <div class="stats-section">
                <p>Players online: <span id="players-count">-</span></p>
                <p>Active tables: <span id="tables-count">-</span></p>
            </div>
        </div>
        
        <!-- Create Table Form (initially hidden) -->
        <div class="section" id="create-table-form" style="display: none;">
            <h2>Create New Table</h2>
            
            <div class="form-group">
                <label for="create-name-input">Your Name:</label>
                <input type="text" id="create-name-input" class="form-input" placeholder="Enter your name">
            </div>
            
            <div class="form-group">
                <h3>Select Your Position:</h3>
                <div class="position-selector">
                    <div class="position-row">
                        <div></div>
                        <div>
                            <button class="position-button" data-position="north">
                                North
                            </button>
                        </div>
                        <div></div>
                    </div>
                    <div class="position-row">
                        <div>
                            <button class="position-button" data-position="west">
                                West
                            </button>
                        </div>
                        <div class="position-center">
                            <div class="position-table"></div>
                        </div>
                        <div>
                            <button class="position-button" data-position="east">
                                East
                            </button>
                        </div>
                    </div>
                    <div class="position-row">
                        <div></div>
                        <div>
                            <button class="position-button" data-position="south">
                                South
                            </button>
                        </div>
                        <div></div>
                    </div>
                </div>
            </div>
            
            <div class="action-buttons">
                <button id="create-submit-button" class="button">
                    Create Table
                </button>
                
                <button id="create-cancel-button" class="button button-secondary">
                    Cancel
                </button>
            </div>
        </div>
        
        <!-- Join Table Form (initially hidden) -->
        <div class="section" id="join-table-form" style="display: none;">
            <h2>Join Existing Table</h2>
            
            <div class="form-group">
                <label for="join-name-input">Your Name:</label>
                <input type="text" id="join-name-input" class="form-input" placeholder="Enter your name">
            </div>
            
            <div class="form-group">
                <label for="table-code-input">Table Code:</label>
                <input type="text" id="table-code-input" class="form-input" placeholder="Enter 4-digit code">
            </div>
            
            <div class="action-buttons">
                <button id="join-submit-button" class="button">
                    Join Table
                </button>
                
                <button id="join-cancel-button" class="button button-secondary">
                    Cancel
                </button>
            </div>
        </div>
        
        <!-- Position Selection Form (initially hidden) -->
        <div class="section" id="position-selection-form" style="display: none;">
            <h2>Select Position</h2>
            <p>Table Code: <span id="position-table-code"></span></p>
            
            <div class="player-positions">
                <div class="position-info" id="position-north">
                    <h3>North</h3>
                    <p class="player-name">Empty</p>
                    <button class="select-position-button" data-position="north">Select</button>
                </div>
                
                <div class="position-info" id="position-east">
                    <h3>East</h3>
                    <p class="player-name">Empty</p>
                    <button class="select-position-button" data-position="east">Select</button>
                </div>
                
                <div class="position-info" id="position-south">
                    <h3>South</h3>
                    <p class="player-name">Empty</p>
                    <button class="select-position-button" data-position="south">Select</button>
                </div>
                
                <div class="position-info" id="position-west">
                    <h3>West</h3>
                    <p class="player-name">Empty</p>
                    <button class="select-position-button" data-position="west">Select</button>
                </div>
            </div>
            
            <div class="action-buttons">
                <button id="position-cancel-button" class="button button-secondary">
                    Cancel
                </button>
            </div>
        </div>
    </div>
    
    <!-- Waiting Room View (initially hidden) -->
    <div class="container" id="waiting-room-view" style="display: none;">
        <h1>BridgeCircle - Table <span id="waiting-table-code"></span></h1>
        
        <!-- ARIA Live area for waiting room announcements -->
        <div id="waiting-announcer" class="sr-only" aria-live="polite" aria-atomic="true"></div>
        
        <div class="section">
            <h2>Waiting for Players</h2>
            <p>Share this table code with your friends: <strong id="share-table-code"></strong></p>
            
            <div class="player-status">
                <div class="player-positions">
                    <div class="position-card" id="waiting-north">
                        <h3>North</h3>
                        <p class="player-name">Waiting...</p>
                    </div>
                    
                    <div class="position-card" id="waiting-east">
                        <h3>East</h3>
                        <p class="player-name">Waiting...</p>
                    </div>
                    
                    <div class="position-card" id="waiting-south">
                        <h3>South</h3>
                        <p class="player-name">Waiting...</p>
                    </div>
                    
                    <div class="position-card" id="waiting-west">
                        <h3>West</h3>
                        <p class="player-name">Waiting...</p>
                    </div>
                </div>
            </div>
            
            <div class="action-buttons">
                <button id="start-game-button" class="button">
                    Start Game (with GIB for missing players)
                </button>
                
                <button id="leave-table-button" class="button button-secondary">
                    Leave Table
                </button>
            </div>
        </div>
        
        <!-- Chat Section -->
        <div class="section">
            <h2>Table Chat</h2>
            <div id="chat-messages" class="chat-messages" aria-live="polite"></div>
            <div class="chat-input-container">
                <input type="text" id="chat-input" class="chat-input" placeholder="Type a message...">
                <button id="send-chat-button" class="button">Send</button>
            </div>
        </div>
    </div>
    
    <!-- Game View (initially hidden) - This is the original game view with multiplayer chat added -->
    <div class="container" id="game-view" style="display: none;">
        <h1>BridgeCircle - Table <span id="game-table-code"></span></h1>
        
        <!-- ARIA Live area for announcements -->
        <div id="status-announcer" class="sr-only" aria-live="polite" aria-atomic="true"></div>
        
        <!-- ARIA Live area specifically for card plays -->
        <div id="card-announcer" class="sr-only" aria-live="assertive" aria-atomic="false"></div>
        
        <!-- Invisible focus target to help with screen reader issues -->
        <span id="card-focus-target" tabindex="-1" aria-hidden="true" style="position:absolute;left:-9999px"></span>
        
        <!-- Player management -->
        <section class="section">
            <h2>Players</h2>
            <div class="player-controls" id="player-controls">
                <!-- Player information will be added here by JavaScript -->
            </div>
        </section>
        
        <!-- Status message display -->
        <div class="status-bar" id="status-bar" role="status">
            Welcome to BridgeCircle application
        </div>
        
        <!-- Action buttons -->
        <div class="action-buttons">
            <button id="toggle-help-button" class="button button-secondary">
                Show Help
            </button>
            
            <button id="leave-game-button" class="button button-secondary">
                Leave Game
            </button>
            
            <button id="fullscreen-button" class="button button-secondary">
                Full Screen
            </button>
        </div>
        
        <!-- Chat Section for in-game chat -->
        <div class="section">
            <h2>Game Chat</h2>
            <div id="game-chat-messages" class="chat-messages" aria-live="polite"></div>
            <div class="chat-input-container">
                <input type="text" id="game-chat-input" class="chat-input" placeholder="Type a message...">
                <button id="game-send-chat-button" class="button">Send</button>
            </div>
        </div>
        
        <!-- Help section (initially hidden) -->
        <section class="help-section" id="help-section" style="display: none;" role="dialog" aria-labelledby="help-heading">
            <h2 id="help-heading">Keyboard Shortcuts</h2>
            <ul class="help-list" id="help-list">
                <!-- Help text will be populated by JavaScript -->
            </ul>
            <button id="close-help-button" class="button">
                Close Help
            </button>
        </section>
        
        <!-- Bidding area -->
        <section class="section" id="bidding-area" style="display: none;">
            <h2>Bidding Phase</h2>
            <div id="bidding-history" class="bidding-history">
                <h3>Bidding History</h3>
                <p>No bids yet.</p>
            </div>
            <div id="bidding-controls" class="bidding-controls">
                <h3>Your Bid</h3>
                <p>Waiting for bidding to start...</p>
            </div>
        </section>
        
        <!-- Game table -->
        <div class="game-table">
            <!-- North (top) -->
            <div class="hand north-hand" id="north-hand">
                <h3>North</h3>
                <!-- Card information will be added here by JavaScript -->
            </div>
            
            <!-- East (right) -->
            <div class="hand east-hand" id="east-hand">
                <h3>East</h3>
                <p>Cards: ?</p>
            </div>
            
            <!-- Center area -->
            <div class="center-area" id="center-area">
                <!-- Played cards and center information will be added here -->
            </div>
            
            <!-- West (left) -->
            <div class="hand west-hand" id="west-hand">
                <h3>West</h3>
                <p>Cards: ?</p>
            </div>
            
            <!-- South (bottom - player's hand) -->
            <div class="hand south-hand" id="south-hand">
                <h3>Your Hand (South)</h3>
                <!-- Card information will be added here by JavaScript -->
            </div>
        </div>
        
        <!-- Played cards -->
        <section class="section" id="played-cards-section">
            <h2>Played Cards</h2>
            <div id="played-cards-container">
                <p class="text-gray-500">No cards played yet.</p>
            </div>
        </section>
    </div>
    
    <!-- JavaScript files -->
    <script src="/socket.io/socket.io.js"></script>
    <script src="scripts/lobby.js"></script>
    <script src="scripts/bidding.js"></script>
    <script src="scripts/ui.js"></script>
    <script src="scripts/game.js"></script>
    <script src="scripts/gib-integration.js"></script>
    <script src="scripts/app.js"></script>
<script>
  // Suoritetaan heti, ei odoteta DOMContentLoaded-tapahtumaa
  (function() {
    console.log('Immediate event handlers being attached');
    
    // Tarkista ja tulosta löytyykö painikkeet
    var createTableButton = document.getElementById('create-table-button');
    var joinTableButton = document.getElementById('join-table-button');
    var playSoloButton = document.getElementById('play-solo-button');
    
    console.log('Buttons found:', {
      createTableButton: !!createTableButton,
      joinTableButton: !!joinTableButton,
      playSoloButton: !!playSoloButton
    });
    
    // Tarkista ja tulosta löytyykö lomakkeet
    var createTableForm = document.getElementById('create-table-form');
    var joinTableForm = document.getElementById('join-table-form');
    
    console.log('Forms found:', {
      createTableForm: !!createTableForm,
      joinTableForm: !!joinTableForm
    });
    
    // Aseta tapahtumankäsittelijät alertien kanssa
    if (createTableButton) {
      createTableButton.onclick = function() {
        alert('Create table button clicked!');
        console.log('Create table clicked via direct onclick');
        if (createTableForm) {
          createTableForm.style.display = 'block';
          console.log('Form display set to block');
        } else {
          console.error('Create form not found!');
        }
        return false; // Estä mahdollinen lomakkeen lähetys
      };
    }
    
    if (joinTableButton) {
      joinTableButton.onclick = function() {
        alert('Join table button clicked!');
        console.log('Join table clicked via direct onclick');
        if (joinTableForm) {
          joinTableForm.style.display = 'block';
          console.log('Form display set to block');
        } else {
          console.error('Join form not found!');
        }
        return false; // Estä mahdollinen lomakkeen lähetys
      };
    }
    
    if (playSoloButton) {
      playSoloButton.onclick = function() {
        alert('Play solo button clicked!');
        console.log('Play solo clicked via direct onclick');
        window.location.href = '/solo.html';
        return false; // Estä mahdollinen lomakkeen lähetys
      };
    }
    
    // Jos painikkeet eivät toimi, kokeillaan luoda backup-painikkeet
    var backupContainer = document.createElement('div');
    backupContainer.style.position = 'fixed';
    backupContainer.style.top = '10px';
    backupContainer.style.right = '10px';
    backupContainer.style.zIndex = '9999';
    backupContainer.style.backgroundColor = 'rgba(255,255,255,0.9)';
    backupContainer.style.padding = '10px';
    backupContainer.style.border = '1px solid black';
    
    var backupCreateButton = document.createElement('button');
    backupCreateButton.textContent = 'Backup Create Table';
    backupCreateButton.style.display = 'block';
    backupCreateButton.style.margin = '5px';
    backupCreateButton.onclick = function() {
      alert('Backup Create button clicked!');
      if (createTableForm) {
        createTableForm.style.display = 'block';
      }
    };
    
    var backupJoinButton = document.createElement('button');
    backupJoinButton.textContent = 'Backup Join Table';
    backupJoinButton.style.display = 'block';
    backupJoinButton.style.margin = '5px';
    backupJoinButton.onclick = function() {
      alert('Backup Join button clicked!');
      if (joinTableForm) {
        joinTableForm.style.display = 'block';
      }
    };
    
    backupContainer.appendChild(backupCreateButton);
    backupContainer.appendChild(backupJoinButton);
    document.body.appendChild(backupContainer);
    console.log('Backup buttons added');
  })(); // Suoritetaan heti
</script>
</body>
</html>