<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BridgeCircle - Accessible Bridge</title>
    <meta name="description" content="Accessible Bridge application with GIB AI player support">
    <style>
/* Base styles and reset */
* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

body {
  font-family: Arial, Helvetica, sans-serif;
  line-height: 1.6;
  max-width: 1200px;
  margin: 0 auto;
  padding: 1rem;
  color: #333;
  background-color: #f9f9f9;
}

/* Accessibility styles */
.sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  margin: -1px;
  border: 0;
  padding: 0;
  overflow: hidden;
  clip: rect(0 0 0 0);
  clip-path: inset(50%);
  white-space: nowrap;
}

/* Focus state for all interactive elements */
input:focus, 
button:focus, 
a:focus, 
select:focus, 
textarea:focus {
  outline: 3px solid #005fcc;
  outline-offset: 2px;
}

/* Typography */
h1 {
  font-size: 1.8rem;
  margin-bottom: 1rem;
  color: #202020;
  text-align: center;
  margin-bottom: 20px;
  color: #2c3e50;
  border-bottom: 2px solid #eee;
  padding-bottom: 10px;
}

h2 {
  font-size: 1.4rem;
  margin-bottom: 0.8rem;
  color: #000000;
}

h3 {
  font-size: 1.2rem;
  margin-bottom: 0.5rem;
  color: #000000;
}

p {
  margin-bottom: 1rem;
}

a {
  color: #005fcc;
  text-decoration: none;
}

a:hover {
  text-decoration: underline;
}

a:visited {
  color: #4527a0;
}

/* Bridge card manager main form */
.bridge-card-manager {
  max-width: 1000px;
  margin: 0 auto;
  background-color: #ffffff;
  border-radius: 10px;
  padding: 1.5rem;
  margin: 1rem 0;
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
}

/* Info boxes */
.info-box, .help-text {
  background-color: #e8f4f8;
  border: 1px solid #b8d8e8;
  border-radius: 8px;
  padding: 1rem;
  margin: 1rem 0;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
  color: #000000;
  font-style: italic;
}

/* Buttons */
.button-container {
  display: flex;
  gap: 10px;
  margin-bottom: 20px;
  flex-wrap: wrap;
}

.action-button {
  background-color: #005fcc;
  color: #FFFFFF;
  padding: 0.8rem 1.2rem;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  font-size: 1rem;
  font-weight: 600;
  transition: background-color 0.2s, transform 0.1s;
  display: inline-block;
  text-align: center;
  flex: 1;
  min-width: 120px;
}

.action-button:hover:not([disabled]) {
  background-color: #004799;
}

.action-button:active:not([disabled]) {
  transform: translateY(1px);
}

.action-button:focus {
  outline: 3px solid #005fcc;
  outline-offset: 2px;
}

#undo-button {
  background-color: #C25100;
}

#undo-button:hover:not([disabled]) {
  background-color: #a84600;
}

#reset-all-button {
  background-color: #B22222;
}

#reset-all-button:hover:not([disabled]) {
  background-color: #9b1d1d;
}

#deal-button {
  background-color: #008000;
}

#deal-button:hover:not([disabled]) {
  background-color: #006400;
}

.close-button {
  padding: 0.8rem 1.2rem;
  background-color: #005A9C;
  color: #FFFFFF;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  font-size: 1rem;
  margin-top: 10px;
  transition: background-color 0.2s;
}

.close-button:hover {
  background-color: #004a80;
}

.action-button[disabled], 
.close-button[disabled],
input[disabled] {
  background-color: #cccccc;
  color: #666666;
  cursor: not-allowed;
}

/* Forms and inputs */
.card-inputs {
  display: none;
  flex-direction: column;
  gap: 20px;
  margin-bottom: 30px;
  padding: 20px;
  background-color: #FFFFFF;
  border-radius: 8px;
}

.card-inputs.show {
  display: flex;
}

.player-section, .dummy-section {
  border: 1px solid #ccc;
  padding: 15px;
  border-radius: 6px;
  background-color: #FFFFFF;
  color: #000000;
}

.input-group {
  display: flex;
  align-items: center;
  margin-bottom: 10px;
}

.input-group label {
  width: 100px;
  display: flex;
  align-items: center;
  font-weight: bold;
  color: #000000;
}

.input-group input {
  flex: 1;
  padding: 0.8rem;
  font-size: 1rem;
  border: 1px solid #ccc;
  border-radius: 6px;
  background-color: #FFFFFF;
  color: #000000;
}

input[type="text"]:focus {
  border-color: #005fcc;
}

/* Card view */
.card-display {
  display: flex;
  flex-direction: column;
  gap: 30px;
}

.player-cards-display, .dummy-cards-display {
  border: 1px solid #ddd;
  padding: 20px;
  border-radius: 8px;
  background-color: #FFFFFF;
  color: #000000;
}

.suit-row {
  margin-bottom: 15px;
  padding-bottom: 15px;
  border-bottom: 1px solid #eee;
}

.suit-row:last-child {
  border-bottom: none;
}

.suit-symbol {
  margin-right: 5px;
  font-size: 1.2em;
}

.spades, .clubs {
  color: black;
}

.hearts, .diamonds {
  color: red;
}

.card-buttons {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
  margin-top: 10px;
}

.card-button {
  width: 40px;
  height: 40px;
  display: flex;
  justify-content: center;
  align-items: center;
  font-size: 16px;
  font-weight: bold;
  background-color: #FFFFFF;
  border: 1px solid #000000;
  border-radius: 6px;
  cursor: pointer;
  transition: all 0.2s;
}

.card-button:hover {
  transform: translateY(-5px);
  box-shadow: 0 5px 10px rgba(0,0,0,0.2);
}

.card-button:focus {
  outline: 3px solid #005fcc;
  background-color: #000000;
  color: #FFFFFF !important;
}

/* New definitions for separate styling of suit symbols and card values */
.card-suit {
  color: inherit; /* Inherits color from parent */
}

.card-value {
  color: black; /* All number values are black */
}

/* Suit symbol colors */
.hearts-button .card-suit, 
.diamonds-button .card-suit {
  color: red;
}

.spades-button .card-suit, 
.clubs-button .card-suit {
  color: black;
}

/* In focus state, all text is white */
.card-button:focus .card-suit,
.card-button:focus .card-value {
  color: white !important;
}

.keyboard-shortcut {
  font-size: 0.9em;
  color: #FFFFFF;
  margin-left: 10px;
}

/* Status message */
.status-bar {
  padding: 12px;
  background: #dbeafe;
  color: #1e40af;
  border-radius: 8px;
  margin: 10px 0 20px 0;
  text-align: center;
  font-weight: 500;
}

/* Players info section */
.players-info {
  display: flex;
  justify-content: space-between;
  margin-bottom: 20px;
  flex-wrap: wrap;
}

.player-info {
  background-color: #f8f8f8;
  border: 1px solid #ddd;
  border-radius: 8px;
  padding: 10px;
  width: 48%;
  margin-bottom: 10px;
}

.player-info.current {
  background-color: #e6f7ff;
  border-color: #91d5ff;
}

/* Played cards */
.game-table {
  display: grid;
  grid-template-columns: 1fr 1fr 1fr;
  grid-template-areas:
      ". north ."
      "west center east"
      ". south .";
  gap: 15px;
  margin: 20px 0;
  background-color: #f0f8ff;
  border-radius: 8px;
  padding: 15px;
}

.north-played { grid-area: north; text-align: center; }
.west-played { grid-area: west; text-align: left; }
.east-played { grid-area: east; text-align: right; }
.south-played { grid-area: south; text-align: center; }
.center-area { grid-area: center; text-align: center; padding: 30px 0; }

.played-card {
  display: inline-block;
  width: 45px;
  height: 60px;
  background-color: white;
  border: 1px solid #000;
  border-radius: 5px;
  text-align: center;
  line-height: 60px;
  font-size: 1.2rem;
  box-shadow: 2px 2px 5px rgba(0,0,0,0.2);
}

.played-cards-section {
  margin-top: 20px;
  padding: 15px;
  border: 1px solid #ddd;
  border-radius: 8px;
  background-color: #FFFFFF;
}

.played-cards-list {
  list-style-type: none;
}

.played-cards-list li {
  margin-bottom: 6px;
}

.card-hearts, .card-diamonds {
  color: red;
}

.card-spades, .card-clubs {
  color: black;
}

/* Animations */
@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

.bridge-card-manager, .card-inputs.show {
  animation: fadeIn 0.3s ease-in-out;
}

/* Media queries for different screen sizes */
/* Small screens and mobile devices */
@media (max-width: 576px) {
  body {
    padding: 0.5rem;
  }
  
  h1 {
    font-size: 1.5rem;
  }
  
  h2 {
    font-size: 1.2rem;
  }
  
  .bridge-card-manager {
    padding: 1rem;
  }
  
  .action-button, .close-button {
    padding: 0.7rem 1rem;
    font-size: 0.95rem;
    width: 100%;
    margin-top: 0.5rem;
  }
  
  .card-inputs {
    padding: 10px;
  }
  
  .player-section, .dummy-section {
    padding: 10px;
  }
  
  .player-info {
    width: 100%;
  }
  
  .game-table {
    grid-template-columns: 1fr;
    grid-template-areas:
        "north"
        "west" 
        "center"
        "east"
        "south";
  }
}

/* Medium screens (tablets) */
@media (min-width: 577px) and (max-width: 768px) {
  body {
    padding: 0.8rem;
  }
  
  .bridge-card-manager {
    padding: 1.2rem;
  }
  
  .action-button, .close-button {
    padding: 0.75rem 1rem;
  }
  
  .card-inputs {
    flex-direction: row;
    flex-wrap: wrap;
  }
  
  .player-section, .dummy-section {
    flex: 1;
    min-width: 300px;
  }
}

/* Dark theme support */
@media (prefers-color-scheme: dark) {
  body {
    background-color: #121212;
    color: #e0e0e0;
  }
  
  h1, h2, h3 {
    color: #f0f0f0;
  }
  
  .bridge-card-manager {
    background-color: #1e1e1e;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
  }
  
  .info-box, .help-text {
    background-color: #1a2c35;
    border-color: #2a4658;
    color: #e0e0e0;
  }
  
  .card-inputs {
    background-color: #252525;
  }
  
  .player-section, .dummy-section {
    background-color: #FFFFFF;
    border-color: #444;
    color: #000000;
  }
  
  .player-cards-display, .dummy-cards-display {
    background-color: #FFFFFF;
    border-color: #444;
    color: #000000;
  }
  
  .suit-row {
    border-bottom-color: #ddd;
  }
  
  input[type="text"] {
    background-color: #FFFFFF;
    border-color: #444;
    color: #000000;
  }
  
  .input-group label {
    color: #000000;
  }
  
  .card-button {
    background-color: #FFFFFF;
    border-color: #000000;
    color: inherit;
  }
  
  .card-button:focus {
    background-color: #000000;
    color: #FFFFFF !important;
  }
  
  .hearts-button, .diamonds-button {
    color: #ff6b6b;
  }
  
  .spades-button, .clubs-button {
    color: #000000;
  }
  
  a {
    color: #5b9eed;
  }
  
  a:visited {
    color: #bb86fc;
  }

  .status-bar {
    background-color: #2a4365;
    color: #a3bffa;
  }
  
  .played-cards-section {
    background-color: #1e1e1e;
    border-color: #444;
  }
  
  .player-info {
    background-color: #2d3748;
    border-color: #4a5568;
  }
  
  .player-info.current {
    background-color: #2a4365;
    border-color: #3182ce;
  }
  
  .game-table {
    background-color: #1a365d;
  }
  
  .played-card {
    background-color: #2d3748;
    border-color: #4a5568;
  }

  /* Ensure card area headings are black in dark theme */
  .player-cards-display h2, .player-cards-display h3,
  .dummy-cards-display h2, .dummy-cards-display h3,
  .player-section h2, .player-section h3,
  .dummy-section h2, .dummy-section h3 {
    color: #000000;
  }

.card-value {
  color: black;
}

.hearts-button .card-suit, 
.diamonds-button .card-suit {
  color: #ff6b6b; /* Dark theme red for suit symbols */
}

.spades-button .card-suit, 
.clubs-button .card-suit {
  color: black;
}

.card-button:focus .card-suit,
.card-button:focus .card-value {
  color: white !important;
}
}

/* Print settings */
@media print {
  body {
    background-color: #ffffff;
    color: #000000;
  }
  
  .button-container, .close-button {
    display: none;
  }
  
  .card-inputs {
    display: none;
  }
  
  .bridge-card-manager {
    box-shadow: none;
    border: none;
  }
  
  a {
    color: #000000;
    text-decoration: none;
  }
}
    </style>
</head>
<body>
    <div id="app" class="bridge-card-manager">
        <h1>BridgeCircle - Accessible Bridge</h1>
        
        <!-- Screen reader status message -->
        <div class="sr-only" id="status-message" aria-live="polite" aria-atomic="true"></div>

        <!-- Button controls -->
        <div class="button-container">
            <button id="player-input-button" class="action-button">
                Enter Your Cards
                <span class="keyboard-shortcut">(Alt+N)</span>
            </button>
            <button id="dummy-input-button" class="action-button">
                Enter Dummy Cards
                <span class="keyboard-shortcut">(Alt+M)</span>
            </button>
            <button id="undo-button" class="action-button">
                Undo Last Move
                <span class="keyboard-shortcut">(Alt+Z)</span>
            </button>
            <button id="reset-all-button" class="action-button">
                Remove All Cards
            </button>
            <button id="deal-button" class="action-button">
                Deal New Cards
            </button>
        </div>

        <!-- Status bar -->
        <div class="status-bar" id="status-bar" role="status">
            Welcome to BridgeCircle Application
        </div>
        
        <!-- Players info -->
        <div class="players-info">
            <div id="north-info" class="player-info">
                <h3>North (Dummy)</h3>
                <p>Player: <span id="north-player-type">Human</span></p>
            </div>
            <div id="east-info" class="player-info">
                <h3>East</h3>
                <p>Player: <span id="east-player-type">GIB AI</span></p>
                <p>Cards: <span id="east-cards-count">13</span></p>
            </div>
            <div id="south-info" class="player-info current">
                <h3>South (You)</h3>
                <p>Player: <span id="south-player-type">You</span></p>
            </div>
            <div id="west-info" class="player-info">
                <h3>West</h3>
                <p>Player: <span id="west-player-type">GIB AI</span></p>
                <p>Cards: <span id="west-cards-count">13</span></p>
            </div>
        </div>

        <!-- Game table for played cards -->
        <div class="game-table" id="game-table">
            <div class="north-played" id="north-played">
                <!-- North played card will appear here -->
            </div>
            <div class="west-played" id="west-played">
                <!-- West played card will appear here -->
            </div>
            <div class="center-area" id="center-area">
                <!-- Current trick info -->
                <h3 id="current-trick-info">Waiting for play</h3>
            </div>
            <div class="east-played" id="east-played">
                <!-- East played card will appear here -->
            </div>
            <div class="south-played" id="south-played">
                <!-- South played card will appear here -->
            </div>
        </div>

        <!-- Player Cards Input Section (hidden by default) -->
        <div id="player-card-inputs" class="card-inputs">
            <section class="player-section">
                <h2 id="player-input-focus" tabindex="-1">Your Cards</h2>
                <div class="input-group">
                    <label for="player-spades">
                        <span class="suit-symbol spades">♠</span> Spades:
                    </label>
                    <input
                        id="player-spades"
                        type="text"
                        aria-describedby="format-help"
                        placeholder="e.g. AQJt9"
                    />
                </div>
                <div class="input-group">
                    <label for="player-hearts">
                        <span class="suit-symbol hearts">♥</span> Hearts:
                    </label>
                    <input
                        id="player-hearts"
                        type="text"
                        aria-describedby="format-help"
                        placeholder="e.g. KQJ"
                    />
                </div>
                <div class="input-group">
                    <label for="player-diamonds">
                        <span class="suit-symbol diamonds">♦</span> Diamonds:
                    </label>
                    <input
                        id="player-diamonds"
                        type="text"
                        aria-describedby="format-help"
                        placeholder="e.g. At98"
                    />
                </div>
                <div class="input-group">
                    <label for="player-clubs">
                        <span class="suit-symbol clubs">♣</span> Clubs:
                    </label>
                    <input
                        id="player-clubs"
                        type="text"
                        aria-describedby="format-help"
                        placeholder="e.g. 765"
                    />
                </div>

                <p id="format-help" class="help-text">
                    Enter cards using A for ace, K for king, Q for queen, J for jack, T for ten, and numbers 2-9.
                </p>

                <button id="close-player-inputs" class="close-button">
                    Done
                </button>
            </section>
        </div>

        <!-- Dummy Cards Input Section (hidden by default) -->
        <div id="dummy-card-inputs" class="card-inputs">
            <section class="dummy-section">
                <h2 id="dummy-input-focus" tabindex="-1">Dummy Cards</h2>
                <div class="input-group">
                    <label for="dummy-spades">
                        <span class="suit-symbol spades">♠</span> Spades:
                    </label>
                    <input
                        id="dummy-spades"
                        type="text"
                        aria-describedby="dummy-format-help"
                        placeholder="e.g. K876"
                    />
                </div>
                <div class="input-group">
                    <label for="dummy-hearts">
                        <span class="suit-symbol hearts">♥</span> Hearts:
                    </label>
                    <input
                        id="dummy-hearts"
                        type="text"
                        aria-describedby="dummy-format-help"
                        placeholder="e.g. At92"
                    />
                </div>
                <div class="input-group">
                    <label for="dummy-diamonds">
                        <span class="suit-symbol diamonds">♦</span> Diamonds:
                    </label>
                    <input
                        id="dummy-diamonds"
                        type="text"
                        aria-describedby="dummy-format-help"
                        placeholder="e.g. QJ7"
                    />
                </div>
                <div class="input-group">
                    <label for="dummy-clubs">
                        <span class="suit-symbol clubs">♣</span> Clubs:
                    </label>
                    <input
                        id="dummy-clubs"
                        type="text"
                        aria-describedby="dummy-format-help"
                        placeholder="e.g. AKQ2"
                    />
                </div>

                <p id="dummy-format-help" class="help-text">
                    Enter cards using A for ace, K for king, Q for queen, J for jack, T for ten, and numbers 2-9.
                </p>

                <button id="close-dummy-inputs" class="close-button">
                    Done
                </button>
            </section>
        </div>

        <div class="card-display">
            <section class="player-cards-display">
                <h2>Your Cards (South)</h2>
                <div class="suit-row">
                    <h3>Spades</h3>
                    <div id="player-spades-buttons" class="card-buttons">
                        <!-- Cards will be inserted here via JavaScript -->
                    </div>
                </div>
                <div class="suit-row">
                    <h3>Hearts</h3>
                    <div id="player-hearts-buttons" class="card-buttons">
                        <!-- Cards will be inserted here via JavaScript -->
                    </div>
                </div>
                <div class="suit-row">
                    <h3>Diamonds</h3>
                    <div id="player-diamonds-buttons" class="card-buttons">
                        <!-- Cards will be inserted here via JavaScript -->
                    </div>
                </div>
                <div class="suit-row">
                    <h3>Clubs</h3>
                    <div id="player-clubs-buttons" class="card-buttons">
                        <!-- Cards will be inserted here via JavaScript -->
                    </div>
                </div>
            </section>

            <section class="dummy-cards-display">
                <h2>Dummy Cards (North)</h2>
                <div class="suit-row">
                    <h3>Spades</h3>
                    <div id="dummy-spades-buttons" class="card-buttons">
                        <!-- Cards will be inserted here via JavaScript -->
                    </div>
                </div>
                <div class="suit-row">
                    <h3>Hearts</h3>
                    <div id="dummy-hearts-buttons" class="card-buttons">
                        <!-- Cards will be inserted here via JavaScript -->
                    </div>
                </div>
                <div class="suit-row">
                    <h3>Diamonds</h3>
                    <div id="dummy-diamonds-buttons" class="card-buttons">
                        <!-- Cards will be inserted here via JavaScript -->
                    </div>
                </div>
                <div class="suit-row">
                    <h3>Clubs</h3>
                    <div id="dummy-clubs-buttons" class="card-buttons">
                        <!-- Cards will be inserted here via JavaScript -->
                    </div>
                </div>
            </section>
        </div>

        <!-- Played cards -->
        <section class="played-cards-section" id="played-cards-section">
            <h2>Played Cards</h2>
            <div id="played-cards-container">
                <p class="text-gray-500">No cards played yet.</p>
            </div>
        </section>
    </div>

    <script>
        // Define card suits and values
        const suits = ["♠", "♥", "♦", "♣"];
        const values = ["2", "3", "4", "5", "6", "7", "8", "9", "10", "J", "Q", "K", "A"];
        
        // Game state variables
        let gameState = {
            players: {
                north: { type: 'human', name: 'Dummy' },
                east: { type: 'gib', name: 'GIB-East' },
                south: { type: 'human', name: 'You' },
                west: { type: 'gib', name: 'GIB-West' }
            },
            currentPlayer: 'south',
            gamePhase: 'setup', // 'setup', 'bidding', 'play', 'end'
            statusMessage: 'Start by dealing cards.',
            hands: {
                north: { 
                    spades: [], 
                    hearts: [], 
                    diamonds: [], 
                    clubs: [] 
                },
                south: { 
                    spades: [], 
                    hearts: [], 
                    diamonds: [], 
                    clubs: [] 
                },
                east: {
                    spades: [],
                    hearts: [],
                    diamonds: [],
                    clubs: []
                },
                west: {
                    spades: [],
                    hearts: [],
                    diamonds: [],
                    clubs: []
                }
            },
            currentTrick: [], // Current trick cards
            trickHistory: [], // History of all tricks
            tricks: { ns: 0, ew: 0 } // Tricks won
        };
        
        // Player and dummy cards
        let playerCards = {
            spades: '',
            hearts: '',
            diamonds: '',
            clubs: ''
        };

        let dummyCards = {
            spades: '',
            hearts: '',
            diamonds: '',
            clubs: ''
        };

        // Played cards and move history
        let playedCards = [];
        let moveHistory = [];

        // DOM element references
        const statusMessageElement = document.getElementById('status-message');
        const statusBarElement = document.getElementById('status-bar');
        const resetAllButton = document.getElementById('reset-all-button');
        const playerInputButton = document.getElementById('player-input-button');
        const dummyInputButton = document.getElementById('dummy-input-button');
        const undoButton = document.getElementById('undo-button');
        const dealButton = document.getElementById('deal-button');
        const playerCardInputs = document.getElementById('player-card-inputs');
        const dummyCardInputs = document.getElementById('dummy-card-inputs');
        const closePlayerInputsButton = document.getElementById('close-player-inputs');
        const closeDummyInputsButton = document.getElementById('close-dummy-inputs');
        const playedCardsContainer = document.getElementById('played-cards-container');
        const currentTrickInfo = document.getElementById('current-trick-info');

        // Player info elements
        const northInfo = document.getElementById('north-info');
        const eastInfo = document.getElementById('east-info');
        const southInfo = document.getElementById('south-info');
        const westInfo = document.getElementById('west-info');
        const northPlayerType = document.getElementById('north-player-type');
        const eastPlayerType = document.getElementById('east-player-type');
        const southPlayerType = document.getElementById('south-player-type');
        const westPlayerType = document.getElementById('west-player-type');
        const eastCardsCount = document.getElementById('east-cards-count');
        const westCardsCount = document.getElementById('west-cards-count');

        // Played cards area
        const northPlayed = document.getElementById('north-played');
        const eastPlayed = document.getElementById('east-played');
        const southPlayed = document.getElementById('south-played');
        const westPlayed = document.getElementById('west-played');

        // Player card input fields
        const playerSpadesInput = document.getElementById('player-spades');
        const playerHeartsInput = document.getElementById('player-hearts');
        const playerDiamondsInput = document.getElementById('player-diamonds');
        const playerClubsInput = document.getElementById('player-clubs');

        // Dummy card input fields
        const dummySpadesInput = document.getElementById('dummy-spades');
        const dummyHeartsInput = document.getElementById('dummy-hearts');
        const dummyDiamondsInput = document.getElementById('dummy-diamonds');
        const dummyClubsInput = document.getElementById('dummy-clubs');

        // Card button containers
        const playerSpadesButtons = document.getElementById('player-spades-buttons');
        const playerHeartsButtons = document.getElementById('player-hearts-buttons');
        const playerDiamondsButtons = document.getElementById('player-diamonds-buttons');
        const playerClubsButtons = document.getElementById('player-clubs-buttons');
        const dummySpadesButtons = document.getElementById('dummy-spades-buttons');
        const dummyHeartsButtons = document.getElementById('dummy-hearts-buttons');
        const dummyDiamondsButtons = document.getElementById('dummy-diamonds-buttons');
        const dummyClubsButtons = document.getElementById('dummy-clubs-buttons');

        // Map card values to indices
        const cardValueMap = {
            '2': 0, '3': 1, '4': 2, '5': 3, '6': 4, '7': 5, '8': 6, '9': 7, 
            't': 8, 'j': 9, 'q': 10, 'k': 11, 'a': 12
        };

        // Map suit names to indices
        const suitIndexMap = {
            'spades': 0,
            'hearts': 1,
            'diamonds': 2,
            'clubs': 3
        };

        // Show player card input
        function showPlayerInputs() {
            dummyCardInputs.classList.remove('show');
            playerCardInputs.classList.add('show');
            setTimeout(() => {
                playerSpadesInput.focus();
            }, 100);
            announceToScreenReader('Enter your cards');
        }

        // Show dummy card input
        function showDummyInputs() {
            playerCardInputs.classList.remove('show');
            dummyCardInputs.classList.add('show');
            setTimeout(() => {
                dummySpadesInput.focus();
            }, 100);
            announceToScreenReader('Enter dummy cards');
        }

        // Hide player card input
        function hidePlayerInputs() {
            playerCardInputs.classList.remove('show');
            announceToScreenReader('Your cards have been saved');
        }

        // Hide dummy card input
        function hideDummyInputs() {
            dummyCardInputs.classList.remove('show');
            announceToScreenReader('Dummy cards have been saved');
        }

        // Parse card string into individual cards
        function parseCards(cardString) {
            const cards = [];
            for (let i = 0; i < cardString.length; i++) {
                const card = cardString[i].toLowerCase();
                cards.push(card);
            }
            return cards;
        }

        // Convert card code to readable string
        function cardToReadable(card) {
            const lowerCard = card.toLowerCase();
            if (lowerCard in cardValueMap) {
                return values[cardValueMap[lowerCard]];
            }
            return card.toUpperCase();
        }

        // Get suit symbol for display
        function suitToReadable(suit) {
            if (suit in suitIndexMap) {
                return suits[suitIndexMap[suit]];
            }
            return suit;
        }

        // Convert suit code to readable text
        function getSuitName(suit) {
            switch(suit) {
                case 'spades': return 'spades';
                case 'hearts': return 'hearts';
                case 'diamonds': return 'diamonds';
                case 'clubs': return 'clubs';
                default: return suit;
            }
        }

        // Announce text to screen reader
        function announceToScreenReader(text) {
            statusMessageElement.textContent = '';
            setTimeout(() => {
                statusMessageElement.textContent = text;
            }, 50);
        }

        // Read cards for a given suit
        function readCards(hand, suit) {
            const cardsString = hand === 'player' ? playerCards[suit] : dummyCards[suit];
            const parsedCards = parseCards(cardsString);
            
            if (parsedCards.length === 0) {
                announceToScreenReader(`No cards`);
                return;
            }
            
            // Filter out played cards
            const availableCards = parsedCards.filter(card => {
                return !isCardPlayed(`${hand === 'player' ? 'south' : 'north'}-${suit}-${card}`);
            });
            
            if (availableCards.length === 0) {
                announceToScreenReader(`No cards`);
                return;
            }
            
            // Get only card values (without suit symbols or other text)
            const cardValues = availableCards.map(card => cardToReadable(card)).join(', ');
            
            // Announce only card values
            announceToScreenReader(cardValues);
            
            // Focus on the corresponding suit section after screen reader finishes reading
            // Calculate delay based on text length (approximately 50ms per character)
            const readingDelay = Math.max(1000, cardValues.length * 50); // At least 1 second or 50ms per character
            
            setTimeout(() => {
                // Get the first available card button in that suit section
                const buttonContainer = document.getElementById(`${hand}-${suit}-buttons`);
                const firstButton = buttonContainer.querySelector('button');
                
                if (firstButton) {
                    // Focus on the first card button
                    firstButton.focus();
                } else {
                    // If no cards available, focus on the suit heading
                    const suitHeading = buttonContainer.previousElementSibling;
                    if (suitHeading) {
                        suitHeading.setAttribute('tabindex', '-1');
                        suitHeading.focus();
                    }
                }
            }, readingDelay);
        }

        // Check if card is already played
        function isCardPlayed(cardKey) {
            // Check in current trick
            for (const play of gameState.currentTrick) {
                if (`${play.player}-${play.suit}-${play.card}` === cardKey) {
                    return true;
                }
            }
            
            // Check in trick history
            for (const trick of gameState.trickHistory) {
                for (const play of trick) {
                    if (`${play.player}-${play.suit}-${play.card}` === cardKey) {
                        return true;
                    }
                }
            }
            
            return false;
        }

        // Handle card play
        function playCard(suit, card, position) {
            // Check if game is in progress
            if (gameState.gamePhase !== 'play') {
                updateStatus('Game is not started yet.');
                return;
            }
            
            // Check if it's this player's turn
            if (gameState.currentPlayer !== position) {
                // Special case: if it's North's (dummy's) turn, South plays its cards
                if (gameState.currentPlayer === 'north' && position === 'north') {
                    // This is OK, dummy's cards are played by South
                } else {
                    updateStatus(`It's not ${getPositionName(position)}'s turn.`);
                    return;
                }
            }
            
            // Check if player needs to follow suit
            if (gameState.currentTrick.length > 0) {
                const leadSuit = gameState.currentTrick[0].suit;
                const hasLeadSuit = gameState.hands[position][leadSuit].length > 0;
                
                // If player must follow suit but card is not the same suit
                if (hasLeadSuit && suit !== leadSuit) {
                    updateStatus(`You must play a ${getSuitName(leadSuit)} if you have one.`);
                    return;
                }
            }
            
            // Play the card
            const play = { player: position, suit, card };
            gameState.currentTrick.push(play);
            
            // Display played card
            displayPlayedCard(position, suit, card);
            
            // Announce played card
            const suitSymbol = suitToReadable(suit);
            const cardValue = cardToReadable(card);
            announceToScreenReader(`${getPositionName(position)} played ${suitSymbol}${cardValue}`);
            
            // Update hands
            if (position === 'south') {
                // Remove card from player's hand
                gameState.hands.south[suit] = gameState.hands.south[suit].filter(c => c !== card);
                // Update Bridge Assistant variables
                playerCards[suit] = playerCards[suit].replace(card.toLowerCase(), '');
            } else if (position === 'north') {
                // Remove card from dummy's hand
                gameState.hands.north[suit] = gameState.hands.north[suit].filter(c => c !== card);
                // Update Bridge Assistant variables
                dummyCards[suit] = dummyCards[suit].replace(card.toLowerCase(), '');
            } else if (position === 'east') {
                // Remove card from east's hand
                gameState.hands.east[suit] = gameState.hands.east[suit].filter(c => c !== card);
                // Update card count in view
                eastCardsCount.textContent = countCards(gameState.hands.east);
            } else if (position === 'west') {
                // Remove card from west's hand
                gameState.hands.west[suit] = gameState.hands.west[suit].filter(c => c !== card);
                // Update card count in view
                westCardsCount.textContent = countCards(gameState.hands.west);
            }
            
            // Move to next player
            const nextPosition = getNextPosition(position);
            gameState.currentPlayer = nextPosition;
            
            // Update player status (who's turn it is)
            updatePlayerStatus();
            
            // Check if trick is complete (4 cards played)
            if (gameState.currentTrick.length === 4) {
                setTimeout(() => {
                    completeTrick();
                }, 1500); // Show trick for a moment before completing
            } else {
                // If next player is GIB, simulate a move
                if (gameState.players[nextPosition].type === 'gib') {
                    updateStatus(`${gameState.players[nextPosition].name} is thinking...`);
                    setTimeout(() => {
                        simulateGIBPlay(nextPosition);
                    }, 1000);
                } else {
                    updateStatus(`${gameState.players[nextPosition].name}'s turn.`);
                }
            }
            
            // Update card display
            renderAllCards();
            renderPlayedCards();
            
            // Save game state
            saveToLocalStorage();
        }
        
        // Display played card on game board
        function displayPlayedCard(position, suit, card) {
            const element = document.getElementById(`${position}-played`);
            if (!element) return;
            
            const suitSymbol = suitToReadable(suit);
            const cardValue = cardToReadable(card);
            const isRed = suit === 'hearts' || suit === 'diamonds';
            
            element.innerHTML = `
                <div class="played-card ${isRed ? 'card-hearts' : 'card-spades'}">
                    ${suitSymbol}${cardValue}
                </div>
            `;
        }
        
        // Clear played cards from game board
        function clearPlayedCards() {
            northPlayed.innerHTML = '';
            eastPlayed.innerHTML = '';
            southPlayed.innerHTML = '';
            westPlayed.innerHTML = '';
        }
        
        // Complete a trick
        function completeTrick() {
            // Determine trick winner
            const winningPlay = determineWinner(gameState.currentTrick);
            
            // Add trick to history
            gameState.trickHistory.push([...gameState.currentTrick]);
            
            // Add point to the correct pair
            if (winningPlay.player === 'north' || winningPlay.player === 'south') {
                gameState.tricks.ns += 1;
            } else {
                gameState.tricks.ew += 1;
            }
            
            // Announce trick winner
            updateStatus(`${getPositionName(winningPlay.player)} won the trick.`);
            announceToScreenReader(`${getPositionName(winningPlay.player)} won the trick.`);
            
            // Clear current trick
            gameState.currentTrick = [];
            
            // Clear played cards from view
            setTimeout(() => {
                clearPlayedCards();
                
                // Check if game is over
                if (isGameOver()) {
                    endGame();
                } else {
                    // Next player is trick winner
                    gameState.currentPlayer = winningPlay.player;
                    updatePlayerStatus();
                    
                    // Update trick info
                    currentTrickInfo.textContent = `North-South: ${gameState.tricks.ns} | East-West: ${gameState.tricks.ew}`;
                    
                    // If next player is GIB, simulate move
                    if (gameState.players[winningPlay.player].type === 'gib') {
                        updateStatus(`${gameState.players[winningPlay.player].name} is thinking...`);
                        setTimeout(() => {
                            simulateGIBPlay(winningPlay.player);
                        }, 1000);
                    } else {
                        updateStatus(`${gameState.players[winningPlay.player].name}'s turn.`);
                    }
                }
            }, 1000);
            
            // Save game state
            saveToLocalStorage();
        }
        
        // Determine trick winner
        function determineWinner(trick) {
            if (trick.length === 0) return null;
            
            // First card determines the suit
            const leadSuit = trick[0].suit;
            let winningPlay = trick[0];
            let highestValue = cardValueMap[trick[0].card.toLowerCase()] || 0;
            
            for (let i = 1; i < trick.length; i++) {
                const play = trick[i];
                const value = cardValueMap[play.card.toLowerCase()] || 0;
                
                // If same suit and higher value
                if (play.suit === leadSuit && value > highestValue) {
                    winningPlay = play;
                    highestValue = value;
                }
            }
            
            return winningPlay;
        }
        
        // Check if game is over
        function isGameOver() {
            // Game ends when all 13 tricks have been played
            return gameState.trickHistory.length >= 13;
        }
        
        // End the game
        function endGame() {
            gameState.gamePhase = 'end';
            
            // Show final result
            const nsScore = gameState.tricks.ns;
            const ewScore = gameState.tricks.ew;
            
            let message = `Game over! Final score: North-South ${nsScore} - East-West ${ewScore}.`;
            
            if (nsScore > ewScore) {
                message += ' North-South wins!';
            } else if (ewScore > nsScore) {
                message += ' East-West wins!';
            } else {
                message += ' It\'s a tie!';
            }
            
            updateStatus(message);
            announceToScreenReader(message);
            
            // Update view
            currentTrickInfo.textContent = message;
        }
        
        // Count cards in hand
        function countCards(hand) {
            return Object.values(hand).reduce((sum, cards) => sum + cards.length, 0);
        }
        
        // Update player status
        function updatePlayerStatus() {
            // Remove 'current' class from all players
            northInfo.classList.remove('current');
            eastInfo.classList.remove('current');
            southInfo.classList.remove('current');
            westInfo.classList.remove('current');
            
            // Add 'current' class to current player
            document.getElementById(`${gameState.currentPlayer}-info`).classList.add('current');
        }
        
        // Get next player
        function getNextPosition(position) {
            const positions = ['north', 'east', 'south', 'west'];
            const currentIndex = positions.indexOf(position);
            return positions[(currentIndex + 1) % 4];
        }

        // Undo last move
        function undoLastMove() {
            if (gameState.currentTrick.length === 0 && gameState.trickHistory.length === 0) {
                announceToScreenReader("No moves to undo");
                return;
            }
            
            // If there are cards in current trick, undo last one
            if (gameState.currentTrick.length > 0) {
                const lastPlay = gameState.currentTrick.pop();
                
                // Return card to player's hand
                if (lastPlay.player === 'south') {
                    gameState.hands.south[lastPlay.suit].push(lastPlay.card);
                    playerCards[lastPlay.suit] += lastPlay.card.toLowerCase();
                } else if (lastPlay.player === 'north') {
                    gameState.hands.north[lastPlay.suit].push(lastPlay.card);
                    dummyCards[lastPlay.suit] += lastPlay.card.toLowerCase();
                } else if (lastPlay.player === 'east') {
                    gameState.hands.east[lastPlay.suit].push(lastPlay.card);
                } else if (lastPlay.player === 'west') {
                    gameState.hands.west[lastPlay.suit].push(lastPlay.card);
                }
                
                // Update card counts
                eastCardsCount.textContent = countCards(gameState.hands.east);
                westCardsCount.textContent = countCards(gameState.hands.west);
                
                // Update current player
                gameState.currentPlayer = lastPlay.player;
                
                // Remove card from game board
                document.getElementById(`${lastPlay.player}-played`).innerHTML = '';
                
                // Announce undo
                const suitSymbol = suitToReadable(lastPlay.suit);
                const cardValue = cardToReadable(lastPlay.card);
                announceToScreenReader(`Undid ${getPositionName(lastPlay.player)}'s card ${suitSymbol}${cardValue}`);
            } 
            // If trick is empty but there's trick history, restore last trick
            else if (gameState.trickHistory.length > 0) {
                // Get last trick from history
                const lastTrick = gameState.trickHistory.pop();
                
                // Restore trick as current trick
                gameState.currentTrick = lastTrick;
                
                // Update tricks
                if (gameState.currentTrick[gameState.currentTrick.length - 1].player === 'north' || 
                    gameState.currentTrick[gameState.currentTrick.length - 1].player === 'south') {
                    gameState.tricks.ns -= 1;
                } else {
                    gameState.tricks.ew -= 1;
                }
                
                // Show trick cards on game board
                clearPlayedCards();
                for (const play of lastTrick) {
                    displayPlayedCard(play.player, play.suit, play.card);
                }
                
                // Update trick info
                currentTrickInfo.textContent = `North-South: ${gameState.tricks.ns} | East-West: ${gameState.tricks.ew}`;
                
                // Announce undo
                announceToScreenReader('Undid last trick');
            }
            
            // Update player status
            updatePlayerStatus();
            
            // Update cards in view
            renderAllCards();
            renderPlayedCards();
            
            // Save game state
            saveToLocalStorage();
        }
        
        // Simulate GIB player move
        function simulateGIBPlay(gibPosition) {
            // Check if position is a GIB player
            if (gameState.players[gibPosition].type !== 'gib') {
                return;
            }
            
            // Get player's hand
            const hand = gameState.hands[gibPosition];
            
            // Check if it's GIB player's turn
            if (gameState.currentPlayer !== gibPosition) {
                return;
            }
            
            // Determine lead suit if any
            let leadSuit = null;
            if (gameState.currentTrick.length > 0) {
                leadSuit = gameState.currentTrick[0].suit;
            }
            
            // Find suit with cards
            let selectedSuit = null;
            let selectedCard = null;
            
            // If previous card played, follow suit if possible
            if (leadSuit && hand[leadSuit].length > 0) {
                selectedSuit = leadSuit;
                selectedCard = hand[leadSuit][0]; // Choose first card in this suit
            } else {
                // Otherwise play from any suit
                const suits = ['spades', 'hearts', 'diamonds', 'clubs'];
                for (const suit of suits) {
                    if (hand[suit].length > 0) {
                        selectedSuit = suit;
                        selectedCard = hand[suit][0]; // Choose first card in this suit
                        break;
                    }
                }
            }
            
            if (!selectedSuit || !selectedCard) {
                console.error(`GIB player ${gibPosition} has no cards!`);
                return;
            }
            
            // Play card
            setTimeout(() => {
                playCard(selectedSuit, selectedCard, gibPosition);
            }, 500);
        }

        // Render card buttons
        function renderCardButtons(position, suit) {
            const hand = position === 'south' ? 'player' : 'dummy';
            const containerElement = document.getElementById(`${hand}-${suit}-buttons`);
            containerElement.innerHTML = ''; // Clear existing buttons
            
            const cardsString = hand === 'player' ? playerCards[suit] : dummyCards[suit];
            const parsedCards = parseCards(cardsString);
            
            // Filter out played cards
            const availableCards = parsedCards.filter(card => {
                return !isCardPlayed(`${position}-${suit}-${card}`);
            });
            
            // Determine if this hand's suit is active
            let isActive = false;
            
            // If it's South's turn
            if (gameState.currentPlayer === 'south' && position === 'south') {
                isActive = true;
            }
            // If it's North's turn (dummy), then South (player) plays those cards
            else if (gameState.currentPlayer === 'north' && position === 'north') {
                isActive = true;
            }
            
            // Check if player needs to follow suit
            let mustFollowSuit = null;
            if (gameState.currentTrick.length > 0 && isActive) {
                mustFollowSuit = gameState.currentTrick[0].suit;
            }
            
            // Check if player has cards of lead suit
            const hasLeadSuit = mustFollowSuit ? gameState.hands[position][mustFollowSuit].length > 0 : false;
            
            availableCards.forEach(card => {
                const button = document.createElement('button');
                
                // Set class based on suit for coloring
                let buttonClass = 'card-button';
                if (suit === 'hearts' || suit === 'diamonds') {
                    buttonClass += ' hearts-button';
                } else {
                    buttonClass += ' spades-button';
                }
                button.className = buttonClass;
                
                // Get suit symbol
                const suitSymbol = suitToReadable(suit);
                
                // Get card value
                const cardValue = cardToReadable(card);
                
                // Create separate span elements for suit symbol and card value
                const suitSpan = document.createElement('span');
                suitSpan.className = 'card-suit'; // Class for suit symbol
                suitSpan.textContent = suitSymbol;
                
                const valueSpan = document.createElement('span');
                valueSpan.className = 'card-value'; // Class for card value
                valueSpan.textContent = cardValue;
                
                // Clear button and add span elements
                button.textContent = '';
                button.appendChild(suitSpan);
                button.appendChild(valueSpan);
                
                // Store original card value as data attribute
                button.setAttribute('data-card', card);
                button.setAttribute('data-suit', suit);
                
                // Set aria-label for screen readers
                button.setAttribute('aria-label', `${suitSymbol}${cardValue}`);
                
                // Check if this card is playable
                let isDisabled = true;
                
                // If game is in progress and this hand is active
                if (gameState.gamePhase === 'play' && isActive) {
                    // If no need to follow suit or this is the lead suit
                    if (!mustFollowSuit || suit === mustFollowSuit) {
                        isDisabled = false;
                    }
                    // If must follow suit but player has none of that suit
                    else if (mustFollowSuit && !hasLeadSuit) {
                        isDisabled = false;
                    }
                }
                
                // Set button state
                button.disabled = isDisabled;
                
                // Add click handler
                button.addEventListener('click', () => {
                    playCard(suit, card, position);
                });
                
                containerElement.appendChild(button);
            });
        }

        // Render all card buttons
        function renderAllCards() {
            renderCardButtons('south', 'spades');
            renderCardButtons('south', 'hearts');
            renderCardButtons('south', 'diamonds');
            renderCardButtons('south', 'clubs');
            renderCardButtons('north', 'spades');
            renderCardButtons('north', 'hearts');
            renderCardButtons('north', 'diamonds');
            renderCardButtons('north', 'clubs');
        }

        // Render played cards
        function renderPlayedCards() {
            // Clear played cards container
            playedCardsContainer.innerHTML = '';
            
            if (gameState.trickHistory.length === 0 && gameState.currentTrick.length === 0) {
                playedCardsContainer.innerHTML = '<p>No cards played yet.</p>';
                return;
            }
            
            let html = '<ul class="played-cards-list">';
            
            // Show trick history first
            gameState.trickHistory.forEach((trick, trickIndex) => {
                const winner = determineWinner(trick);
                html += `<li><strong>Trick ${trickIndex + 1}:</strong> ${getPositionName(winner.player)} won</li>`;
                
                trick.forEach((play, playIndex) => {
                    const suitSymbol = suitToReadable(play.suit);
                    const cardValue = cardToReadable(play.card);
                    const isRed = play.suit === 'hearts' || play.suit === 'diamonds';
                    
                    html += `
                        <li style="margin-left: 20px;">
                            ${playIndex + 1}. ${getPositionName(play.player)}: 
                            <span class="${isRed ? 'card-hearts' : 'card-spades'}">
                                ${suitSymbol}${cardValue}
                            </span>
                        </li>
                    `;
                });
            });
            
            // Then show current trick
            if (gameState.currentTrick.length > 0) {
                html += `<li><strong>Current trick:</strong></li>`;
                
                gameState.currentTrick.forEach((play, playIndex) => {
                    const suitSymbol = suitToReadable(play.suit);
                    const cardValue = cardToReadable(play.card);
                    const isRed = play.suit === 'hearts' || play.suit === 'diamonds';
                    
                    html += `
                        <li style="margin-left: 20px;">
                            ${playIndex + 1}. ${getPositionName(play.player)}: 
                            <span class="${isRed ? 'card-hearts' : 'card-spades'}">
                                ${suitSymbol}${cardValue}
                            </span>
                        </li>
                    `;
                });
            }
            
            html += '</ul>';
            playedCardsContainer.innerHTML = html;
        }

        // Save to local storage
        function saveToLocalStorage() {
            localStorage.setItem('gameState', JSON.stringify(gameState));
            localStorage.setItem('playerCards', JSON.stringify(playerCards));
            localStorage.setItem('dummyCards', JSON.stringify(dummyCards));
        }

        // Load from local storage
        function loadFromLocalStorage() {
            const savedGameState = localStorage.getItem('gameState');
            const savedPlayerCards = localStorage.getItem('playerCards');
            const savedDummyCards = localStorage.getItem('dummyCards');
            
            if (savedGameState) {
                gameState = JSON.parse(savedGameState);
            }
            
            if (savedPlayerCards) {
                playerCards = JSON.parse(savedPlayerCards);
                playerSpadesInput.value = playerCards.spades;
                playerHeartsInput.value = playerCards.hearts;
                playerDiamondsInput.value = playerCards.diamonds;
                playerClubsInput.value = playerCards.clubs;
            }
            
            if (savedDummyCards) {
                dummyCards = JSON.parse(savedDummyCards);
                dummySpadesInput.value = dummyCards.spades;
                dummyHeartsInput.value = dummyCards.hearts;
                dummyDiamondsInput.value = dummyCards.diamonds;
                dummyClubsInput.value = dummyCards.clubs;
            }
            
            // Update player status and show played cards
            updatePlayerStatus();
            
            // Update card counts
            eastCardsCount.textContent = countCards(gameState.hands.east);
            westCardsCount.textContent = countCards(gameState.hands.west);
            
            // Show current trick cards
            clearPlayedCards();
            for (const play of gameState.currentTrick) {
                displayPlayedCard(play.player, play.suit, play.card);
            }
            
            // Update trick info
            currentTrickInfo.textContent = gameState.currentTrick.length === 0 ? 
                `North-South: ${gameState.tricks.ns} | East-West: ${gameState.tricks.ew}` : 
                'Trick in progress';
            
            // Update views
            renderAllCards();
            renderPlayedCards();
            
            // Update status message
            updateStatus(gameState.statusMessage);
        }

        // Reset all cards
        function resetCards() {
            // Clear hands
            for (const position of ['north', 'east', 'south', 'west']) {
                gameState.hands[position] = {
                    spades: [],
                    hearts: [],
                    diamonds: [],
                    clubs: []
                };
            }
            
            // Reset other game state variables
            gameState.currentTrick = [];
            gameState.trickHistory = [];
            gameState.tricks = { ns: 0, ew: 0 };
            gameState.gamePhase = 'setup';
            gameState.currentPlayer = 'south';
            gameState.statusMessage = 'Cards removed. Start by dealing or entering cards.';
            
            // Clear Bridge Assistant card variables
            playerCards = {
                spades: '',
                hearts: '',
                diamonds: '',
                clubs: ''
            };
            
            dummyCards = {
                spades: '',
                hearts: '',
                diamonds: '',
                clubs: ''
            };
            
            // Clear input fields
            playerSpadesInput.value = '';
            playerHeartsInput.value = '';
            playerDiamondsInput.value = '';
            playerClubsInput.value = '';
            dummySpadesInput.value = '';
            dummyHeartsInput.value = '';
            dummyDiamondsInput.value = '';
            dummyClubsInput.value = '';
            
            // Update views
            updateStatus(gameState.statusMessage);
            updatePlayerStatus();
            clearPlayedCards();
            currentTrickInfo.textContent = 'Waiting for play';
            eastCardsCount.textContent = '0';
            westCardsCount.textContent = '0';
            
            // Update cards and played cards
            renderAllCards();
            renderPlayedCards();
            
            // Save game state
            saveToLocalStorage();
            
            // Announce to screen reader
            announceToScreenReader('Cards removed');
        }

        // Deal new cards
        function dealNewCards() {
            updateStatus('Dealing cards...');
            
            // Reset game first
            resetCards();
            
            // Create random deal
            generateRandomDeal();
            
            // Update card variables to Bridge Assistant format
            convertDealtCardsToBridgeAssistant();
            
            // Start the game automatically
            gameState.gamePhase = 'play';
            gameState.currentPlayer = 'south';
            
            // Update views
            updatePlayerStatus();
            
            // Clear game board
            clearPlayedCards();
            
            // Update trick info
            currentTrickInfo.textContent = 'North-South: 0 | East-West: 0';
            
            // Update status message
            updateStatus('New cards dealt! Your turn.');
            announceToScreenReader('New cards have been dealt. Game started. Your turn.');
            
            // Update played card counts
            eastCardsCount.textContent = '13';
            westCardsCount.textContent = '13';
            
            // Update cards display
            renderAllCards();
            renderPlayedCards();
            
            // Save game state
            saveToLocalStorage();
        }

        // Convert dealt cards to Bridge Assistant format
        function convertDealtCardsToBridgeAssistant() {
            // Clear previous cards
            playerCards = {
                spades: '',
                hearts: '',
                diamonds: '',
                clubs: ''
            };
            
            dummyCards = {
                spades: '',
                hearts: '',
                diamonds: '',
                clubs: ''
            };
            
            // Convert south (player) and north (dummy) cards
            for (const suit of ['spades', 'hearts', 'diamonds', 'clubs']) {
                // Player cards (south)
                playerCards[suit] = gameState.hands.south[suit].join('').toLowerCase();
                
                // Update input fields
                const playerInput = document.getElementById(`player-${suit}`);
                if (playerInput) {
                    playerInput.value = playerCards[suit];
                }
                
                // Dummy cards (north)
                dummyCards[suit] = gameState.hands.north[suit].join('').toLowerCase();
                
                // Update input fields
                const dummyInput = document.getElementById(`dummy-${suit}`);
                if (dummyInput) {
                    dummyInput.value = dummyCards[suit];
                }
            }
            
            // Update views
            renderAllCards();
            renderPlayedCards();
            
            // Save game state
            saveToLocalStorage();
        }

        // Generate random deal
        function generateRandomDeal() {
            // Create deck (52 cards)
            const deck = [];
            const suits = ['spades', 'hearts', 'diamonds', 'clubs'];
            const values = ['2', '3', '4', '5', '6', '7', '8', '9', 'T', 'J', 'Q', 'K', 'A'];
            
            for (const suit of suits) {
                for (const value of values) {
                    deck.push({ suit, value });
                }
            }
            
            // Shuffle deck
            for (let i = deck.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [deck[i], deck[j]] = [deck[j], deck[i]]; // Swap positions
            }
            
            // Initialize empty hands
            for (const position of ['north', 'east', 'south', 'west']) {
                gameState.hands[position] = {
                    spades: [],
                    hearts: [],
                    diamonds: [],
                    clubs: []
                };
            }
            
            // Deal 13 cards to each player
            const positions = ['north', 'east', 'south', 'west'];
            for (let i = 0; i < deck.length; i++) {
                const position = positions[Math.floor(i / 13)];
                const card = deck[i];
                gameState.hands[position][card.suit].push(card.value);
            }
            
            // Sort cards by suit (A, K, Q, J, T, 9, ..., 2)
            for (const position of positions) {
                for (const suit of suits) {
                    gameState.hands[position][suit].sort((a, b) => {
                        return values.indexOf(b) - values.indexOf(a);
                    });
                }
            }
            
            // Update game state
            gameState.gamePhase = 'setup';
            gameState.currentTrick = [];
            gameState.trickHistory = [];
            gameState.tricks = { ns: 0, ew: 0 };
            gameState.currentPlayer = 'south';
        }

        // Helper functions
        function getPositionName(position) {
            const names = { north: 'North', east: 'East', south: 'South', west: 'West' };
            return names[position] || position;
        }

        // Update status message
        function updateStatus(message) {
            gameState.statusMessage = message;
            statusBarElement.textContent = message;
        }

        // Add event listeners for input fields
        playerSpadesInput.addEventListener('input', (e) => {
            playerCards.spades = e.target.value.toLowerCase();
            gameState.hands.south.spades = parseCards(playerCards.spades);
            saveToLocalStorage();
            renderAllCards();
        });

        playerHeartsInput.addEventListener('input', (e) => {
            playerCards.hearts = e.target.value.toLowerCase();
            gameState.hands.south.hearts = parseCards(playerCards.hearts);
            saveToLocalStorage();
            renderAllCards();
        });

        playerDiamondsInput.addEventListener('input', (e) => {
            playerCards.diamonds = e.target.value.toLowerCase();
            gameState.hands.south.diamonds = parseCards(playerCards.diamonds);
            saveToLocalStorage();
            renderAllCards();
        });

        playerClubsInput.addEventListener('input', (e) => {
            playerCards.clubs = e.target.value.toLowerCase();
            gameState.hands.south.clubs = parseCards(playerCards.clubs);
            saveToLocalStorage();
            renderAllCards();
        });

        dummySpadesInput.addEventListener('input', (e) => {
            dummyCards.spades = e.target.value.toLowerCase();
            gameState.hands.north.spades = parseCards(dummyCards.spades);
            saveToLocalStorage();
            renderAllCards();
        });

        dummyHeartsInput.addEventListener('input', (e) => {
            dummyCards.hearts = e.target.value.toLowerCase();
            gameState.hands.north.hearts = parseCards(dummyCards.hearts);
            saveToLocalStorage();
            renderAllCards();
        });

        dummyDiamondsInput.addEventListener('input', (e) => {
            dummyCards.diamonds = e.target.value.toLowerCase();
            gameState.hands.north.diamonds = parseCards(dummyCards.diamonds);
            saveToLocalStorage();
            renderAllCards();
        });

        dummyClubsInput.addEventListener('input', (e) => {
            dummyCards.clubs = e.target.value.toLowerCase();
            gameState.hands.north.clubs = parseCards(dummyCards.clubs);
            saveToLocalStorage();
            renderAllCards();
        });

        // Add click events for buttons
        playerInputButton.addEventListener('click', showPlayerInputs);
        dummyInputButton.addEventListener('click', showDummyInputs);
        closePlayerInputsButton.addEventListener('click', hidePlayerInputs);
        closeDummyInputsButton.addEventListener('click', hideDummyInputs);
        resetAllButton.addEventListener('click', resetCards);
        undoButton.addEventListener('click', undoLastMove);
        dealButton.addEventListener('click', dealNewCards);

        // Set up keyboard shortcuts
        document.addEventListener('keydown', (event) => {
            // Check if Alt key is pressed
            if (event.altKey) {
                switch (event.key) {
                    case 'n': // Alt+N - Enter your cards
                        showPlayerInputs();
                        event.preventDefault();
                        break;
                    case 'm': // Alt+M - Enter dummy cards
                        showDummyInputs();
                        event.preventDefault();
                        break;
                    case 'z': // Alt+Z - Undo last move
                        undoLastMove();
                        event.preventDefault();
                        break;
                    case 'a': // Alt+A - Read player's spades
                        readCards('player', 'spades');
                        event.preventDefault();
                        break;
                    case 's': // Alt+S - Read player's hearts
                        readCards('player', 'hearts');
                        event.preventDefault();
                        break;
                    case 'd': // Alt+D - Read player's diamonds
                        readCards('player', 'diamonds');
                        event.preventDefault();
                        break;
                    case 'f': // Alt+F - Read player's clubs
                        readCards('player', 'clubs');
                        event.preventDefault();
                        break;
                    case 'q': // Alt+Q - Read dummy's spades
                        readCards('dummy', 'spades');
                        event.preventDefault();
                        break;
                    case 'w': // Alt+W - Read dummy's hearts
                        readCards('dummy', 'hearts');
                        event.preventDefault();
                        break;
                    case 'e': // Alt+E - Read dummy's diamonds
                        readCards('dummy', 'diamonds');
                        event.preventDefault();
                        break;
                    case 'r': // Alt+R - Read dummy's clubs
                        readCards('dummy', 'clubs');
                        event.preventDefault();
                        break;
                    default:
                        break;
                }
            }
        });

        // Initialize application
        loadFromLocalStorage();
    </script>
</body>
</html>